{"cells":[{"cell_type":"code","source":["pip install pyspark"],"metadata":{"id":"AxkXr2qHXy1U","executionInfo":{"status":"ok","timestamp":1719872297635,"user_tz":180,"elapsed":60508,"user":{"displayName":"","userId":""}},"outputId":"757fea6c-3810-470f-ffb3-b65277dde3cf","colab":{"base_uri":"https://localhost:8080/"}},"execution_count":1,"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting pyspark\n","  Downloading pyspark-3.5.1.tar.gz (317.0 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m317.0/317.0 MB\u001b[0m \u001b[31m3.4 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25h  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n","Requirement already satisfied: py4j==0.10.9.7 in /usr/local/lib/python3.10/dist-packages (from pyspark) (0.10.9.7)\n","Building wheels for collected packages: pyspark\n","  Building wheel for pyspark (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for pyspark: filename=pyspark-3.5.1-py2.py3-none-any.whl size=317488491 sha256=98eee952538e7f5e52f40ba224452e11909ef77f47f59424ed4558ab2b22e6e5\n","  Stored in directory: /root/.cache/pip/wheels/80/1d/60/2c256ed38dddce2fdd93be545214a63e02fbd8d74fb0b7f3a6\n","Successfully built pyspark\n","Installing collected packages: pyspark\n","Successfully installed pyspark-3.5.1\n"]}]},{"cell_type":"code","source":["from pyspark.sql import SparkSession\n","\n","import pandas as pd\n","import numpy as np\n","import random\n","import matplotlib.pyplot as plt\n","\n","corredores = 6\n","voltas = 10\n","\n","volta = np.round(np.random.uniform(1, 10, (corredores, voltas)),2)\n","df1 = pd.DataFrame(volta)\n","nomes = ['pedro','ian','jean','william','joão','maria']\n","df1.columns = ['V-'+str(i) for i in range(1,voltas+1)]\n","df1.insert(0, 'corredores', nomes)\n","print(df1)\n","\n","#uma pista de kart permite 10 voltas para cada 6 corredores faça um programa que determinine aleatoriamente a volta de cada corredor volta maxima volta minima campeao\n","\n"],"metadata":{"id":"oYjpBgAwY-Wf","executionInfo":{"status":"ok","timestamp":1719874544462,"user_tz":180,"elapsed":282,"user":{"displayName":"","userId":""}},"outputId":"b40b3eed-9a45-4fae-d30e-a8ae8ddbb262","colab":{"base_uri":"https://localhost:8080/"}},"execution_count":31,"outputs":[{"output_type":"stream","name":"stdout","text":["  corredores   V-1   V-2   V-3   V-4   V-5   V-6   V-7   V-8   V-9  V-10\n","0      pedro  7.30  6.43  3.97  5.34  1.16  1.11  1.59  9.72  1.49  6.90\n","1        ian  3.45  9.27  1.03  7.04  1.91  4.69  4.72  5.71  7.12  7.12\n","2       jean  9.94  7.74  9.51  6.16  8.11  2.10  2.05  8.83  6.47  6.37\n","3    william  8.12  7.39  7.02  1.24  2.54  2.20  1.06  4.62  8.73  4.37\n","4       joão  2.83  6.21  7.01  8.99  2.94  2.82  8.22  4.46  4.36  5.72\n","5      maria  8.97  3.99  8.66  8.76  7.14  8.03  5.66  9.84  6.08  1.20\n"]}]},{"cell_type":"code","source":["spark = SparkSession.builder.appName(\"KartSQL\").getOrCreate()\n","\n","#uma pista de kart permite 10 voltas para cada 6 corredores faça um programa que determinine aleatoriamente a volta de cada corredor volta maxima volta minima campeao\n","\n","pyspark_df = spark.createDataFrame(df1)\n","pyspark_df.show()\n","\n","\n"],"metadata":{"id":"eiiBG0m6alx1","executionInfo":{"status":"ok","timestamp":1719874566176,"user_tz":180,"elapsed":1195,"user":{"displayName":"","userId":""}},"outputId":"9519e9dd-8829-4c4b-8214-cbf506c84acc","colab":{"base_uri":"https://localhost:8080/"}},"execution_count":32,"outputs":[{"output_type":"stream","name":"stdout","text":["+----------+----+----+----+----+----+----+----+----+----+----+\n","|corredores| V-1| V-2| V-3| V-4| V-5| V-6| V-7| V-8| V-9|V-10|\n","+----------+----+----+----+----+----+----+----+----+----+----+\n","|     pedro| 7.3|6.43|3.97|5.34|1.16|1.11|1.59|9.72|1.49| 6.9|\n","|       ian|3.45|9.27|1.03|7.04|1.91|4.69|4.72|5.71|7.12|7.12|\n","|      jean|9.94|7.74|9.51|6.16|8.11| 2.1|2.05|8.83|6.47|6.37|\n","|   william|8.12|7.39|7.02|1.24|2.54| 2.2|1.06|4.62|8.73|4.37|\n","|      joão|2.83|6.21|7.01|8.99|2.94|2.82|8.22|4.46|4.36|5.72|\n","|     maria|8.97|3.99|8.66|8.76|7.14|8.03|5.66|9.84|6.08| 1.2|\n","+----------+----+----+----+----+----+----+----+----+----+----+\n","\n"]}]},{"cell_type":"code","source":["df_soma = pyspark_df.withColumn('soma',pyspark_df['V-1'] + pyspark_df['V-2'] + pyspark_df['V-3'] + pyspark_df['V-4'] + pyspark_df['V-5'] + pyspark_df['V-6'] )\n","df_soma.show()"],"metadata":{"id":"DRM5TbVrg5lh","executionInfo":{"status":"ok","timestamp":1719874994023,"user_tz":180,"elapsed":1290,"user":{"displayName":"","userId":""}},"outputId":"54f4a7b4-fa8b-4a83-8058-8b430f3167eb","colab":{"base_uri":"https://localhost:8080/"}},"execution_count":38,"outputs":[{"output_type":"stream","name":"stdout","text":["+----------+----+----+----+----+----+----+----+----+----+----+------------------+\n","|corredores| V-1| V-2| V-3| V-4| V-5| V-6| V-7| V-8| V-9|V-10|              soma|\n","+----------+----+----+----+----+----+----+----+----+----+----+------------------+\n","|     pedro| 7.3|6.43|3.97|5.34|1.16|1.11|1.59|9.72|1.49| 6.9|             25.31|\n","|       ian|3.45|9.27|1.03|7.04|1.91|4.69|4.72|5.71|7.12|7.12|             27.39|\n","|      jean|9.94|7.74|9.51|6.16|8.11| 2.1|2.05|8.83|6.47|6.37|43.559999999999995|\n","|   william|8.12|7.39|7.02|1.24|2.54| 2.2|1.06|4.62|8.73|4.37|28.509999999999994|\n","|      joão|2.83|6.21|7.01|8.99|2.94|2.82|8.22|4.46|4.36|5.72|              30.8|\n","|     maria|8.97|3.99|8.66|8.76|7.14|8.03|5.66|9.84|6.08| 1.2|45.550000000000004|\n","+----------+----+----+----+----+----+----+----+----+----+----+------------------+\n","\n"]}]},{"cell_type":"code","source":["from pyspark.sql.functions import col\n","\n","menor_valor = df_soma.agg( min(\"soma\")).collect()[0][0]\n","print(menor_valor)\n","df_soma.filter(df_soma.soma == menor_valor).show()\n","campeao = df_soma.filter(col('soma') == menor_valor).collect()[0][0]\n","print('O campeão é',campeao, 'com o menor tempo na soma das 10 voltas',menor_valor)\n","\n","\n","final = {'corredor': [campeao], 'menor tempo': [menor_valor]}\n","\n","df2 = pd.DataFrame(final)  # Use the 'final' dictionary here\n","#nomes = campeão  # This line seems unnecessary\n","df2.columns = ['corredor','menor tempo']\n","df2.index = [1]\n","\n","\n","pyspark_df = spark.createDataFrame(df2)\n","pyspark_df.show()"],"metadata":{"id":"JadhbuMlizqC","executionInfo":{"status":"ok","timestamp":1719879399374,"user_tz":180,"elapsed":2384,"user":{"displayName":"","userId":""}},"outputId":"cf2ed679-df65-4f7d-d364-76140b6710f4","colab":{"base_uri":"https://localhost:8080/"}},"execution_count":80,"outputs":[{"output_type":"stream","name":"stdout","text":["25.31\n","+----------+---+----+----+----+----+----+----+----+----+----+-----+\n","|corredores|V-1| V-2| V-3| V-4| V-5| V-6| V-7| V-8| V-9|V-10| soma|\n","+----------+---+----+----+----+----+----+----+----+----+----+-----+\n","|     pedro|7.3|6.43|3.97|5.34|1.16|1.11|1.59|9.72|1.49| 6.9|25.31|\n","+----------+---+----+----+----+----+----+----+----+----+----+-----+\n","\n","O campeão é pedro com o menor tempo na soma das 10 voltas 25.31\n","+--------+-----------+\n","|corredor|menor tempo|\n","+--------+-----------+\n","|   pedro|      25.31|\n","+--------+-----------+\n","\n"]}]},{"cell_type":"code","source":["df_soma.createOrReplaceTempView(\"df_soma\")\n","spark.sql(\"select (corredores),(soma) from df_soma\").show()"],"metadata":{"id":"LGp4rurQvEm2","executionInfo":{"status":"ok","timestamp":1719878478789,"user_tz":180,"elapsed":975,"user":{"displayName":"","userId":""}},"outputId":"31ce9eef-d23b-4834-a8ae-18cfdc8f24e4","colab":{"base_uri":"https://localhost:8080/"}},"execution_count":76,"outputs":[{"output_type":"stream","name":"stdout","text":["+----------+------------------+\n","|corredores|              soma|\n","+----------+------------------+\n","|     pedro|             25.31|\n","|       ian|             27.39|\n","|      jean|43.559999999999995|\n","|   william|28.509999999999994|\n","|      joão|              30.8|\n","|     maria|45.550000000000004|\n","+----------+------------------+\n","\n"]}]}],"metadata":{"colab":{"name":"Olá, este é o Colaboratory","toc_visible":true,"provenance":[{"file_id":"/v2/external/notebooks/intro.ipynb","timestamp":1719879417605}]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}